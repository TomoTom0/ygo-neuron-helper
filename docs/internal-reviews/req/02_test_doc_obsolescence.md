# テストとドキュメントの陳腐化調査依頼書

**作成日時**: 2025-11-18  
**対象**: PR #10マージ後のコードベース (v0.3.10 → v0.3.11)  
**レビュー目的**: 既存テスト・ドキュメントの正確性確保と更新箇所の特定  
**レポート出力先**: `docs/internal-reviews/reports/test-doc-obsolescence.md`

## 背景

PR #10により大幅な機能追加と変更が行われました：

### 主要な変更内容
- Rush Duel対応（OCG/Rush二重対応）
- デッキメタデータ管理機能の追加
- PNG形式でのデッキ情報埋め込み機能
- URL State管理の導入
- 設定管理システムの刷新
- ドラッグ&ドロップUIの大幅改善

### 変更統計
- 73ファイル変更
- 新規テスト: `tests/unit/utils/page-detector.test.ts`のみ
- ドキュメント: 複数ファイルに影響

## レビュー依頼項目

### A. 既存テストの陳腐化調査

#### A-1. ユニットテストの妥当性確認

**対象ディレクトリ**: `tests/unit/`

**確認観点**:
- [ ] テスト対象のAPI変更によるテスト失敗の有無
- [ ] テストケースが実際の動作を正しく検証しているか
- [ ] モック・スタブが現在の実装と整合しているか
- [ ] アサーションが期待値と一致しているか

**特に重点的にチェックすべきテスト**:
```
tests/unit/api/
tests/unit/stores/
tests/unit/utils/
tests/unit/content/
```

#### A-2. テストカバレッジの現状把握

**確認事項**:
- [ ] 現在のカバレッジ率（特に新規追加ファイル）
- [ ] テストが存在しない主要モジュール
- [ ] カバレッジが低下したモジュール

**コマンド**: `npm run test:coverage` (存在する場合)

#### A-3. E2Eテストの影響調査

**対象**: `tests/e2e/` (存在する場合)

**確認観点**:
- [ ] UI変更によるセレクタの無効化
- [ ] ユーザーフローの変更（特にメタデータ関連）
- [ ] 新規ページタイプ対応（Rush Duel）

### B. ドキュメントの陳腐化調査

#### B-1. ユーザー向けドキュメント

**対象ファイル**:
- `README.md` ✓ (更新済み)
- `docs/usage/` 配下
- `CHANGELOG.md` ✓ (更新済み)
- `public/images/README.md` ✓ (更新済み)

**確認観点**:
- [ ] 機能説明が現在の実装と一致しているか
- [ ] スクリーンショット・画像が最新UIに対応しているか
- [ ] 操作手順に追加・変更が必要な箇所
- [ ] 削除された機能への言及の有無

**特に確認すべき項目**:
- デッキ編集画面の説明（メタデータタブ追加）
- エクスポート/インポート機能（PNG形式追加）
- 設定項目の説明（新規設定項目）
- Rush Duelページでの動作説明

#### B-2. 開発者向けドキュメント

**対象ファイル**:
- `docs/dev/` 配下
- `docs/api/` 配下
- `docs/design/` 配下
- `CLAUDE.md` ✓ (更新済み)

**確認観点**:
- [ ] アーキテクチャ図の更新必要性（Store追加、新規utils）
- [ ] API仕様の変更箇所
- [ ] 型定義の変更説明
- [ ] コーディング規約との整合性

#### B-3. タスク管理ドキュメント

**対象ファイル**:
- `tasks/done.md` ✓ (更新済み)
- `tasks/wip.md` ✓ (更新済み)
- `tasks/todo.md` ✓ (更新済み)
- `tasks/pending.md` ✓ (更新済み)
- `tasks/milestone.md` ✓ (更新済み)

**確認観点**:
- [ ] 完了タスクが正しくdoneに移動されているか
- [ ] 残タスクの記述が現状と一致しているか
- [ ] 新たに発生した技術的負債の記録

#### B-4. アーカイブドキュメント

**対象**: `docs/_archived/`

**確認観点**:
- [ ] アーカイブすべき古いドキュメントの有無
- [ ] アーカイブ済みドキュメントへの誤った参照
- [ ] 履歴的価値のあるドキュメントの保存状況

### C. サンプル・デモファイルの妥当性

**対象**:
- `tests/sample/` 配下
- `ref/` 配下（存在する場合）

**確認観点**:
- [ ] サンプルコードが現在のAPIで動作するか
- [ ] サンプルURLの有効性（`tests/sample/url.md`）
- [ ] デモデータの形式が最新か

### D. コメント・JSDocの整合性

**確認観点**:
- [ ] 関数シグネチャ変更に伴うJSDocの更新漏れ
- [ ] TODOコメントの妥当性（完了済みなのに残っているもの）
- [ ] FIXMEコメントの現状
- [ ] インラインコメントと実装の乖離

## 調査方法

### 推奨アプローチ

1. **自動検出**:
   ```bash
   # テスト実行
   npm run test
   
   # カバレッジ確認
   npm run test:coverage
   
   # リンク切れチェック（markdownlint等）
   npx markdown-link-check docs/**/*.md
   ```

2. **差分ベース調査**:
   ```bash
   # PR #10での変更ファイル一覧
   git diff --name-only caa0149^..caa0149
   
   # 各変更ファイルに対応するテスト/ドキュメントの存在確認
   ```

3. **手動レビュー**:
   - 主要な変更箇所のドキュメントを実際に読み、操作手順を試す
   - スクリーンショットと現在のUIを比較

## 期待する成果物

### 1. 陳腐化リスト

形式:
```markdown
## 廃止すべき項目
- [ ] `tests/unit/old-api.test.ts` - 対象APIが削除済み
- [ ] `docs/usage/old-feature.md` - 機能が刷新された

## 修正すべき項目
- [ ] `README.md` L.45-52 - デッキ編集画面の説明にメタデータタブが未記載
- [ ] `docs/api/deck-store.md` - settingsストアへの分離が未反映

## 付随する追加が必要な項目
- [ ] Rush Duelページでのスクリーンショット追加
- [ ] PNG形式エクスポートの使用例追加
```

### 2. 更新優先度マトリックス

| 項目 | 影響範囲 | 緊急度 | 難易度 |
|------|----------|--------|--------|
| README.md機能説明 | ユーザー全体 | 高 | 低 |
| E2Eテスト修正 | CI/CD | 高 | 中 |
| API仕様書更新 | 開発者 | 中 | 中 |

### 3. テスト・ドキュメント更新計画書

- 作業順序
- 各作業の見積もり工数
- 担当候補（人/エージェント）

## 備考

- ✓マークはPR #10で更新済みを示す
- `docs/_archived/tasks/done_before_2025-11-17.md`は新規アーカイブファイル
- 画像ファイルはPNG→WebP変換、GIF→MP4変換が実施済み
