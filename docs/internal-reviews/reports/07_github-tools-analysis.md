# GitHub Tools Analysis

**作成日時**: 2025-11-18
**元要求**: docs/internal-reviews/req/07_github_tools_investigation.md

## 要約
本分析は、`gh`（GitHub CLI）を用いた現在の運用で頻出する作業を洗い出し、自動化・効率化のために導入可能なツールや方針を評価したものです。主にPRレビューの「レビューコメントへの個別返信」に作業負荷が集中しており、これが自動化対象として最も効果が大きいと判断しました。

## 現状の問題点
- PRレビューコメントへの個別返信が手作業で複数回発生し、コメントID取得→返信投稿の2段階操作でミスが起きやすい。
- `gh api` での複雑なJSON構築やページネーション処理が煩雑。
- 自動化・スクリプト化は存在するが、エラーハンドリングや再利用性が限定的で、知識が一部の担当者に依存している。

## 頻出操作（要自動化候補）
- PRレビュー関連
  - レビューコメント一覧取得
  - 複数コメントへの一括返信（最重要）
  - レビュー承認/変更要求
  - コメントの「解決」操作

- PR操作
  - PRマージ（既に`gh pr merge`で簡略化されている）
  - PR更新（ラベルやタイトルの一括更新）

- イシュー操作
  - ラベル付与・一括更新

## 候補ツール評価
- gh extensions (既存): `gh-dash`、`gh-fzf` 等は閲覧や選択操作を効率化するが、一括返信の専用機能は限定的。
- カスタム `gh` 拡張（Shell/Go）: 最も自然な拡張方法。`gh extension` で配布・インストール可能。
- 専用スクリプト（Node.js / Python）: HTTPクライアント（octokit 等）を用いることで複雑なJSON処理とページネーション管理、リトライやエラーハンドリングを柔軟に実装できる。
- ワークフロー（GitHub Actions）: サーバ側で定期実行やイベント駆動の処理には有効だが、ローカル操作（レビューワークフローの対話的処理）には不向き。

## 推奨アプローチ
1. 短期（低コスト）: ローカルに小さな `gh` 拡張（Shellスクリプト）を作成し、
   - PR番号を受け取り、`gh api` でレビューコメントを取得
   - テンプレートもしくは一括返信ファイル（YAML/JSON）を読み込んで全コメントへPOST
   - 最低限のエラーハンドリング（HTTPステータスチェック、ログ出力）
  理由: 既存環境に導入が容易で、ユーザーへの学習コストが低い。

2. 中期（高信頼）: Node.js/Python 製の小さなツール（`octokit/rest.js` または `PyGithub`）を実装
   - ページネーション、並列リトライ、テンプレート展開、dry-run モードを実装
   - 設定ファイルで対象コメントフィルタ（ファイルパス、未返信のみ、特定ラベル）を指定可能にする
   - CIでの自動チェックやローカルCLIとして配布
  理由: 拡張性と堅牢性が高く、将来の複雑な自動化にも対応可能。

3. 補完策: `gh` 拡張と組み合わせることで、日常的な操作は `gh` 拡張で、複雑な一括処理は Node/Python ツールに委譲する運用を推奨。

## 実装案（簡易 `gh` 拡張の擬似ワークフロー）
1. コマンド: `gh review-reply --pr 10 --template-file replies.yml` 
2. 処理:
   - `gh api repos/:owner/:repo/pulls/:pr/comments` でコメント一覧取得
   - `replies.yml` を読み込み、コメントの `path` や `position` に基づき対象コメントを選別
   - 各対象コメントへ `gh api -X POST repos/:owner/:repo/pulls/:pr/comments/:id/replies -f body=...` を実行
   - 失敗時はログに記録し、終了時にサマリ出力

## セキュリティと運用上の注意
- 自動返信は誤送信リスクがあるため、`--dry-run` モードでの事前検証を必須にすること。
- トークン（`GITHUB_TOKEN` や個人アクセストークン）の権限は最小限（repo:status/read/write 等）に制限すること。
- ツール配布時はバージョン管理とリリース手順を明確にすること。

## 優先度付き実行計画（短期→中期）
1. `gh` 拡張（Shell）で「レビューコメント一括返信」機能を実装（1-2日開発）
2. 運用でのフィードバックを収集（2週間運用）
3. Node.js/Python ベースの堅牢版を設計・実装（2-3週間）
4. CI統合・ドキュメント整備・トレーニング

## 次のアクション（提案）
- 「短期: `gh` 拡張」 の PoC を作成します。実装を希望する場合は私に指示してください。
- または「中期: Node.js/Python 実装」を優先する場合は要件の詳細化（フィルタ条件、テンプレート仕様）を共有してください。

