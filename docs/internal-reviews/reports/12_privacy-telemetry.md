# プライバシー & テレメトリ レポート

作成日: 2025-11-18
基にした依頼: `docs/internal-reviews/req/12_privacy_telemetry.md`

要約

- 本リポジトリは主に「ブラウザ内完結」のChrome拡張機能であり、公式ドキュメント（`docs/dev/privacy-policy.md`）では「データは外部送信しない」と明記されています。
- リポジトリ内のソースコードを横断的に検索した結果、外部解析・テレメトリ SDK（Sentry / Amplitude / Mixpanel 等）や明示的な外部送信処理は検出されませんでした。
- ただし、`cgid` のようなユーザー識別子がURLに含まれており、拡張機能内で扱われる旨の記述が複数箇所に存在します。これは個人識別につながる可能性があるため、取り扱いに注意が必要です。

確認手順

- レビュー依頼の対象要件（A〜D）に従い以下を確認しました。
  - A. 収集データの洗い出し: `docs/dev/privacy-policy.md` とソースコード（`src/` 以下）をスキャン。`cgid`、`dno`、デッキ情報、ユーザー設定（`chrome.storage` / `localStorage`）の使用を確認。
  - B. ユーザー同意の扱い: オプトイン/オプトアウトのUI（設定ページ）を`src/options` や `src/stores/settings.ts` で確認。設定による機能のON/OFFはあるが、拡張機能外へのデータ送信を伴うテレメトリは存在しないため、一般的な「同意」フローは不要と判断される箇所も多い。
  - C. データ保持と削除ポリシー: `docs/dev/privacy-policy.md` にローカル保存（chrome.storage.local）と削除手順（アンインストールで削除）が明記されている。
  - D. 外部サービス連携のレビュー: 依存関係・ソースコードに外部解析SDKは見つからず、外部送信の痕跡は無し。テスト用やドキュメント内にOneTrustスニペットや外部CDN参照はあるが、本拡張の実行時に外部へデータを送る仕組みは特に見当たりません。

検出した項目（詳細）

- 収集 / 処理されるデータ
  - URLパラメータ: `cgid`, `dno`, `ytkn` 等（デッキURL解析に使用）
  - ページ/デッキ内容: カード名、枚数、デッキ名など（DOMパース）
  - ユーザー操作: ボタン操作、設定変更、テキスト入力（主に拡張機能の機能として利用）
  - 保存データ: 設定（feature toggles）、デッキメタデータ（chrome.storage.local / localStorage）

- 個人情報リスク
  - `cgid` はユーザー固有の識別子であり、他サービスへの送信やログ化は個人情報漏洩リスクを高めます。現在はローカル保存と記載されているためリスクは限定的だが、将来の変更で外部送信が加わると問題になる可能性があります。

- 外部リソースの参照
  - テスト用HTML（`tests/`）やドキュメントではOneTrustや外部CDN参照が見られる（Cookie同意関連のスニペット等）。ただし、拡張機能本体のランタイムでこれらが自動的に実行される箇所は確認できませんでした。

改善提案（優先度付き）

1. 明示的なデータフロー図を追加（高）
   - `docs/dev/privacy-policy.md` に簡潔な図やフローを追加し、「どの値がどこで生成・保存・破棄されるか」を示してください。特に `cgid` と `ytkn` の取り扱い（保存場所、表示/エクスポートの有無）を明示すること。

2. `cgid` の取り扱いに関する注意書き（高）
   - `docs/dev/privacy-policy.md` と `docs/README.md` の該当箇所に、`cgid` が個人識別になり得る旨と外部送信の禁止（将来的な変更時の注意）を追記してください。

3. ログ出力のレビュー（中）
   - 開発用の `console.log` がソース内に多数残っています（`src/` や `tests/`）。ブラウザ拡張ではコンソールはユーザーがアクセス可能なため、`cgid` 等の識別子がログに出力されていないか確認し、必要があればログ内容を削減または開発ビルドのみ出力するようにしてください。

4. 外部依存の追加時のガイドライン（中）
   - 将来的にテレメトリやクラッシュレポート（例: Sentry）を導入する場合の承認フローとドキュメント手順（オプトイン必須、データ最小化、契約確認等）を作成してください。

5. オプトインUIの検討（低）
   - もし将来分析目的で匿名化済みイベントを収集する計画がある場合、ユーザーが設定画面で明示的にオンにできる仕組みを実装してください。

推奨アクション

- 今すぐ行うべきこと
  - `docs/dev/privacy-policy.md` に `cgid` の取り扱いに関する注意を追記する（短いパラグラフ）
  - ソース内 `console.log` の出力内容を確認し、個人識別子が含まれていないかをレビューチェックリストに追加する

- 将来的に行うこと
  - テレメトリ導入時の社内承認フローとユーザー向け同意フローを整備する
  - データフロー図を `docs/` に追加

付録: 参照した箇所

- `docs/internal-reviews/req/12_privacy_telemetry.md`
- `docs/dev/privacy-policy.md`
- ソースコード全体のキーワード検索（`cgid`, `dno`, `chrome.storage`, `localStorage`）による検査

