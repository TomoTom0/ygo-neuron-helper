# ãƒ†ã‚¹ãƒˆæ›´æ–°ãƒ¬ãƒãƒ¼ãƒˆ

## ä¾é ¼ç•ªå·
REQ-15

## å®Ÿè¡Œæ—¥æ™‚
2025-11-22

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

### å…¨ä½“ã‚µãƒãƒªãƒ¼
```
Test Files  19 failed | 13 passed (32)
Tests       56 failed | 290 passed | 7 skipped (353)
```

### æˆåŠŸç‡
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: 68% (13/32)
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**: 81% (290/353)

---

## å®Ÿè¡Œã—ãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### âœ… æˆåŠŸã—ãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (13)

1. tests/unit/utils/page-detector.test.ts (23 cases)
2. tests/unit/utils/mapping-manager.test.ts (16 cases)
3. src/content/card/__tests__/detector.test.ts (14 cases)
4. tests/unit/components/CardInfo.test.ts (7 cases)
5. tests/unit/utils/deck-string-parser.test.ts (6 cases)
6. tests/unit/utils/category-grouping.test.ts (ä¸€éƒ¨æˆåŠŸ: 6/9)
7. tests/unit/components/DeckSection.test.ts (ä¸€éƒ¨æˆåŠŸ: 7/12)
8. src/api/__tests__/card-search.test.ts (ä¸€éƒ¨æˆåŠŸ: 0/9)
9. src/api/__tests__/deck-operations.test.ts (ä¸€éƒ¨æˆåŠŸ: 0/8)
10. src/content/parser/__tests__/deck-parser.test.ts (ä¸€éƒ¨æˆåŠŸ: 1/7)
11. src/content/session/__tests__/session.test.ts (ä¸€éƒ¨æˆåŠŸ)
12. tests/combine/parser/deck-detail.test.ts (0 tests)
13. tests/combine/parser/card-detail-page.test.ts (0 tests)

### âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (19)

ä¸»ãªå¤±æ•—ç†ç”±åˆ¥åˆ†é¡:

#### 1. APIãƒ»ãƒ¢ãƒƒã‚¯é–¢é€£ã®å¤±æ•— (9ãƒ•ã‚¡ã‚¤ãƒ«)
- src/api/__tests__/card-search.test.ts (9ä»¶)
- src/api/__tests__/deck-operations.test.ts (8ä»¶)
  - åŸå› : APIãƒ¢ãƒƒã‚¯ã®è¨­å®šä¸å‚™

#### 2. æ§‹é€ ãƒ»å‹å®šç¾©ã®ä¸ä¸€è‡´ (3ãƒ•ã‚¡ã‚¤ãƒ«)
- src/content/parser/__tests__/deck-parser.test.ts (3ä»¶)
  - åŸå› : parseCardRow ã®æˆ»ã‚Šå€¤æ§‹é€ ãŒå¤‰æ›´
    - `imageId` â†’ `card.ciid` + `card.imgs`
    - deckType ãŒæ–‡å­—åˆ—ã§è¿”ã•ã‚Œã¦ã„ã‚‹

#### 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢é€£ (2ãƒ•ã‚¡ã‚¤ãƒ«)
- tests/unit/components/DeckSection.test.ts (5ä»¶)
- tests/unit/components/SearchInputBar.test.ts (4ä»¶) â† **æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆä¸è¶³**

#### 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† (1ãƒ•ã‚¡ã‚¤ãƒ«)
- src/content/session/__tests__/session.test.ts (1ä»¶)
  - åŸå› : HTMLãƒ¢ãƒƒã‚¯å†…ã« cgid ãŒè¦‹ã¤ã‹ã‚‰ãªã„

#### 5. åº—èˆ—é–¢é€£ (2ãƒ•ã‚¡ã‚¤ãƒ«)
- tests/unit/stores/deck-edit.test.ts (19ä»¶)
- tests/unit/stores/deck-list.test.ts (8ä»¶)
  - åŸå› : ã‚¹ãƒˆã‚¢å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆã®åŒæœŸã‚ºãƒ¬

#### 6. ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ (1ãƒ•ã‚¡ã‚¤ãƒ«)
- tests/unit/utils/category-grouping.test.ts (3ä»¶)
  - åŸå› : ã²ã‚‰ãŒãªãƒ»æ¼¢å­—å‡¦ç†ã®ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´

---

## ä¾é ¼å†…å®¹ã®å¯¾å¿œçŠ¶æ³

### 1. æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ç¢ºèªã¨ä¿®æ­£

#### çŠ¶æ³
- âœ… **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†**
- âŒ **ä¿®æ­£æœªå®Œäº†** (56 ä»¶ã®å¤±æ•—)

#### ä¿®æ­£ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆã®å†…è¨³

| ã‚«ãƒ†ã‚´ãƒª | å¤±æ•—æ•° | å„ªå…ˆåº¦ | åŸå›  |
|---------|--------|---------|------|
| parser | 3 | ğŸ”´ é«˜ | æˆ»ã‚Šå€¤æ§‹é€ ã®å¤‰æ›´ |
| API mock | 17 | ğŸ”´ é«˜ | ãƒ¢ãƒƒã‚¯è¨­å®šä¸å‚™ |
| Store | 27 | ğŸŸ¡ ä¸­ | å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆã®åŒæœŸã‚ºãƒ¬ |
| Session | 1 | ğŸ”´ é«˜ | ãƒ¢ãƒƒã‚¯ HTML ã®ä¸å®Œå…¨æ€§ |
| Component | 5 | ğŸŸ¡ ä¸­ | SearchInputBar ãªã©æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| Utils | 3 | ğŸŸ¡ ä¸­ | ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´å¯¾å¿œ |

### 2. æ–°è¦ãƒ†ã‚¹ãƒˆã®ä½œæˆ

#### çŠ¶æ³
- âš ï¸ **ä¸€éƒ¨å®Ÿè£…**

#### SearchInputBar ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: tests/unit/components/SearchInputBar.test.ts
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 4 ä»¶
- **æˆåŠŸ**: 0 ä»¶
- **å¤±æ•—**: 4 ä»¶
- **ç†ç”±**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ãŒå®Œäº†ã—ã¦ã„ãªã„ã‹ã€ãƒ†ã‚¹ãƒˆãŒå¤ã„å¯èƒ½æ€§

#### CardList ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: tests/unit/components/CardList.test.ts
- **ç¢ºèªä¸­**: ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã€uuidæ°¸ç¶šåŒ–ã€å±•é–‹çŠ¶æ…‹ã®ç¶­æŒ

#### SORT_ORDER_TO_API_VALUE ãƒãƒƒãƒ”ãƒ³ã‚°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: src/utils/sort-mapping.test.ts
- **çŠ¶æ³**: ãƒ†ã‚¹ãƒˆã¯å­˜åœ¨ã™ã‚‹ãŒã€å¤±æ•—ä¸­

### 3. E2Eãƒ†ã‚¹ãƒˆã®ç¢ºèª

#### çŠ¶æ³
- âš ï¸ **ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã¯å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„**
- **ç†ç”±**: `tests/browser/` ã® E2E ãƒ†ã‚¹ãƒˆã¯ `npm run test:vitest` ã§ã¯å®Ÿè¡Œã•ã‚Œãªã„
- **å®Ÿè¡Œæ–¹æ³•**: åˆ¥é€” Playwright ã§å®Ÿè¡ŒãŒå¿…è¦

---

## è©³ç´°ãªå¤±æ•—ä¾‹

### ä¾‹ 1: parseCardRow ã®æ§‹é€ å¤‰æ›´

**ãƒ†ã‚¹ãƒˆæœŸå¾…å€¤:**
```javascript
{
  name: 'ãƒ–ãƒ©ãƒƒã‚¯ãƒ»ãƒã‚¸ãƒƒã‚¯',
  cardId: '67890',
  cardType: 'spell',
  imageId: '2',  // æœŸå¾…å€¤
  quantity: 3,
}
```

**å®Ÿéš›ã®æˆ»ã‚Šå€¤:**
```javascript
{
  card: {
    name: 'ãƒ–ãƒ©ãƒƒã‚¯ãƒ»ãƒã‚¸ãƒƒã‚¯',
    cardId: '67890',
    cardType: 'spell',
    ciid: '1',      // æ–°ã—ã„å±æ€§
    imgs: [{ ciid: '1', imgHash: '...' }],  // æ–°ã—ã„æ§‹é€ 
  },
  quantity: 3,
}
```

**å¯¾å¿œ**: ãƒ†ã‚¹ãƒˆã®æœŸå¾…å€¤ã‚’æ–°ã—ã„æ§‹é€ ã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

---

## ã‚«ãƒãƒ¬ãƒƒã‚¸æƒ…å ±

ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯å–å¾—ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
æ¨å¥¨: `npm run test:vitest -- --coverage` ã§ç¢ºèªå¯èƒ½

---

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ğŸ”´ å„ªå…ˆåº¦: é«˜ (v0.4.0ãƒªãƒªãƒ¼ã‚¹å‰ã«å¯¾å¿œå¿…é ˆ)

1. **Parser ãƒ†ã‚¹ãƒˆä¿®æ­£** (3ä»¶)
   - src/content/parser/__tests__/deck-parser.test.ts ã®æœŸå¾…å€¤ã‚’æ›´æ–°

2. **API ãƒ¢ãƒƒã‚¯ä¿®æ­£** (17ä»¶)
   - src/api/__tests__/card-search.test.ts
   - src/api/__tests__/deck-operations.test.ts
   - global fetch ãƒ¢ãƒƒã‚¯ã®è¨­å®šè¦‹ç›´ã—

3. **Session ãƒ†ã‚¹ãƒˆä¿®æ­£** (1ä»¶)
   - src/content/session/__tests__/session.test.ts ã® HTML ãƒ¢ãƒƒã‚¯å®Œæˆ

### ğŸŸ¡ å„ªå…ˆåº¦: ä¸­ (å¯èƒ½ãªã‚‰å¯¾å¿œ)

4. **Store ãƒ†ã‚¹ãƒˆä¿®æ­£** (27ä»¶)
   - Pinia store ã®å®Ÿè£…çŠ¶æ…‹ã‚’ç¢ºèª
   - ãƒ†ã‚¹ãƒˆã®åŒæœŸã‚’å–ã‚‹

5. **SearchInputBar ãƒ†ã‚¹ãƒˆ** (4ä»¶)
   - æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆæ•´å‚™

6. **Utils ãƒ†ã‚¹ãƒˆä¿®æ­£** (3ä»¶)
   - ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ãƒ­ã‚¸ãƒƒã‚¯ã®ç¢ºèª

### âšª å„ªå…ˆåº¦: ä½

7. **E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
   - `npm run test:browser` ã¾ãŸã¯ Playwright ã§å®Ÿè¡Œ
   - åˆ¥é€”æ‰‹å‹•ç¢ºèªãŒå¿…è¦

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®åŸå› ç‰¹å®šã¨ä¿®æ­£
2. SearchInputBar ãªã©æ–°è¦ãƒ†ã‚¹ãƒˆã®å……å®Ÿ
3. ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã¨ç›®æ¨™è¨­å®š
4. E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒã®æ•´å‚™

