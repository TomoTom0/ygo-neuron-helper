# ブラウザ自動テスト方針レビューレポート

参照: `docs/internal-reviews/req/05_browser_test_strategy.md`

## 概要
- ドキュメントはブラウザ（拡張機能）向けのE2Eテスト導入方針を体系的にまとめており、範囲・選定理由・ディレクトリ構成・メンテナンス戦略・移行計画まで網羅しています。
- 全体の構成は実行可能で現実的。特にPlaywright採用、Page Object Model、段階的導入フェーズの提案は妥当です。

## 良い点
- 画面単位・コンポーネント単位の分類が具体的で、優先度マトリックスや期待成果物が明確。
- 既存の `tmp/browser/` スクリプトを再利用候補として分析する点は現場での導入コスト低減に効果的。
- CI統合例やディレクトリ設計の具体例があり、開発者が実装に移りやすい。
- テスト更新・メンテナンスのガイドラインがあるため、継続運用の体制構築に寄与する。

## 改善(推奨)点
- 拡張機能（manifest v3）特有の制約について、もう少し具体的な設定手順（例: Playwrightで拡張機能をロードする方法、必要な権限の記述）を追加すると導入ハードルが下がります。
- `data-testid` を全ての新規コンポーネントに追加する運用ルールと、既存コードへ安全に追加するためのミグレーション手順を明記してください（例: lintルールやコードレビューのチェック項目）。
- テストの実行時間短縮のための並列度やCIでのリソース見積り、及び flaky テストの検出・隔離ポリシー（retries, quarantine）の方針を追加してください。
- テストデータ（フィクスチャ）のバージョン管理・生成方法（シードスクリプト等）を明示すると再現性が高まります。
- セキュリティ面の注意（テストで扱うAPIキー等の管理方法）を追加してください。

## 追加で推奨する具体的アクション
- `docs/testing/e2e-testing-guide.md` にPlaywrightで拡張機能をロードするサンプル（簡易手順）を追加する。
- CIワークフロー例に `npx playwright test --reporter=dot` のような失敗情報の簡潔な出力設定や、結果アーティファクトの収集例を追記する。
- `tmp/browser/` スクリプト分析の実作業チケットを作成し、まずは高優先度のスクリプトを2本（`add-40-cards.js`, `check-animation.js`）の置き換えを着手する。

## 小さな編集提案（ドキュメント改善）
- 用語の統一: `E2E` と `e2e`、`Playwright` の表記ゆれを統一してください。
- 期待成果物のファイルパス例をすべて `tests/e2e/...` の形式で統一してください。

## 結論
- 本ドキュメントは現実的でよくまとまっており、実装フェーズに移す準備が整っています。上記の改善点を反映すれば導入・運用の成功率がさらに高まる見込みです。

