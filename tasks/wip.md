# WIP

現在作業中のタスク（進行中）

## 調査フェーズ（2025-10-30）
- [x] カード検索機能の詳細調査フェーズ1（完了）
  - [x] 基本検索フォームの構造確認（140フィールド特定）
  - [x] 主要パラメータの解析（属性、種族、効果、検索タイプなど）
  - [x] 公式JSファイルのダウンロードと解析
  - [x] 中間レポートの作成（docs/research/card-search-parameters.md）
- [x] カード検索機能の詳細調査フェーズ2（完了）
  - [x] 残りのチェックボックスパラメータの詳細調査
    - `other` (その他条件) 15個のラベルと意味
    - `jogai` (除外条件) 15個のラベルと意味
    - リンクマーカー `linkbtn1-9` の方向マッピング
  - [x] 実際の検索操作とURL変化の記録
    - 属性のみ指定して検索
    - 種族のみ指定して検索
    - 攻撃力範囲を指定して検索
    - レベル範囲を指定して検索
    - 複合条件（複数パラメータ組み合わせ）で検索
    - 各検索結果のURLを記録
  - [x] 複数選択パラメータの動作確認
  - [x] 隠しパラメータの発見（rp=2000など）
  - [x] リンクマーカー機能の完全解明
  - [x] i18nデータ構造の作成
  - [x] 検索パラメータ完全仕様書の完成

## カード情報HTML構造調査（2025-10-30 完了）
- [x] 検索結果ページのHTML構造調査
  - [x] カードアイテム（.t_row.c_normal）の構造確認
  - [x] カード名、ふりがな、CID、画像URLの取得方法
  - [x] 属性、レベル、種族、ATK/DEF情報の抽出
  - [x] カードテキストの取得
  - [x] ページネーション構造の確認
- [x] カード詳細ページのHTML構造調査
  - [x] 収録パック情報の構造（発売日、カードナンバー、レアリティ）
  - [x] 関連カード情報の取得（検索結果と同じ構造）
  - [x] Q&A情報の構造（質問タイトル、タグ、更新日）
  - [x] Q&A一覧ページの構造確認
- [x] ドキュメント作成
  - [x] `docs/research/card-information-structure.md`の作成

## デッキ操作API調査（2025-10-30 完了）
- [x] デッキ保存API（ope=3）の完全解明
  - [x] Regist()関数の実装確認
  - [x] jQueryのAJAXリクエストの仕様
  - [x] フォームのserialize()メソッドの動作確認
  - [x] レスポンス形式の確認（JSON）
- [x] カード追加操作の仕組み
  - [x] 65個のカード入力スロットの構造確認
  - [x] カード名、枚数、カードID、画像IDの関係
  - [x] 空のスロットへのカード追加手順
  - [x] プログラムからのカード追加と保存の実装
- [x] デッキ操作（削除・複製・共有）の調査
  - [x] デッキ削除（ope=7）の確認ダイアログと API
  - [x] デッキ複製（ope=8）の仕組み
  - [x] デッキコード発行（ope=13）機能

## カード検索とタイプ判定の詳細調査（2025-11-04 完了）
- [x] DOM属性ベースのカードタイプ判定方法の確立
  - [x] img要素のsrc属性を使用した判定ロジック
  - [x] ロケール非依存の実装確認
  - [x] テキストベース判定の非推奨化
- [x] ctypeパラメータの正確な値の確認
  - [x] selectボックスであることの確認（ラジオボタンではない）
  - [x] 正確なマッピング: 空文字列=すべて、1=モンスター、2=魔法、3=罠
  - [x] 実際のHTMLダンプによる検証
- [x] ブラウザJavaScriptからのfetch操作の調査
  - [x] Content Scriptsからのfetch動作確認
  - [x] DOMParserでのHTML解析動作確認
  - [x] CORS制限がないことの確認
  - [x] Chrome拡張での実装方針の確立

## 現在の状態（2025-11-04 20:15）
カード検索APIの修正、ビルドシステムの修正、ESモジュールエラーの修正がすべて完了しました。
- ✅ APIパラメータ修正完了
- ✅ DOMセレクタ修正完了
- ✅ ビルドシステム修正完了
- ✅ ESモジュールエラー修正完了（ポストビルドスクリプトによる`export {}`削除）
- ✅ デプロイ完了
- ✅ 拡張機能動作確認完了（Content Scriptが正常にロード）

次のステップ：
- カード検索API統合（Content ScriptからAPIを呼び出す機能実装）
- または、次の機能実装へ進む（todo.mdを参照）

## 次の調査項目（未着手）
- [ ] カードIDの自動解決メカニズム
  - カード名からカードIDを取得する方法
  - オートコンプリート機能の調査
  - imgsパラメータの生成方法

## 次のフェーズ（調査完了後）
- [ ] API仕様書の完成
- [ ] データモデル設計（カード、デッキ、ユーザー設定）
- [ ] Chrome拡張機能の実装方針確定
- [ ] 実装フェーズへの移行

一時的なノートや未整理の下書きはローカルで `tmp/wip/` に保管してください（`tmp/` は `.gitignore` に登録されています）。
詳細な調査計画は `tmp/wip/investigation-plan.md` を参照してください。
