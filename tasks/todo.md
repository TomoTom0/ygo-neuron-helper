# TODO

未着手のタスク（優先度順）

## 📊 現状サマリー

**Phase 1（調査）**: ✅ 完了
**Phase 2（独立機能）**: ✅ 完了（v0.2.0）
**Phase 3（デッキ編集UI + i18n基盤）**: ✅ 完了（v0.3.0）
**Phase 4（デッキ編集画面実装）**: ✅ 完了（v0.4.0 - PR #10マージ済み）
**テスト・ドキュメント追加**: 🔄 開発中

### リリース状況
- **v0.3.0**: ✅ リリース済み（2025-11-13）
- **v0.3.1**: ✅ リリース済み（2025-11-14）
- **v0.3.2**: ✅ 開発完了（リリース準備完了）
- **v0.4.0**: 🔄 開発中（Phase 1: 基盤整備）

### 現在の作業ブランチ
- `feature/v0.4.0-foundation`（Phase 1: 基盤整備）

---

## v0.4.0開発タスク（Phase 1: 基盤整備）

### 📋 実装計画
**Phase 1完了条件:**
- USP（URL State Parameters）による状態管理
- 画像サイズ4段階切り替え
- カラーテーマ3種（dark/light/system）
- 言語切り替え（10言語 + auto）

**詳細:** `tmp/wip/v0.4.0-investigation.md`, `tasks/wip.md`

---

> **Note**: 設定ストアとUSP実装は完了済み（2025-11-17）→ `tasks/done.md` 参照

---

### 0. メタデータ管理の改善（優先度：高）

#### 0.1 タグマスターデータの取得実装
- [ ] `src/utils/deck-metadata-loader.ts`の`updateDeckMetadata()`を修正
  - デッキ検索ページからタグマスターデータを取得
  - `DeckMetadata`インターフェースに`tags: Record<string, string>`を追加
  - chrome.storage.localに保存
- [ ] タグマスターデータの初期JSONファイル作成
  - `src/data/deck-metadata.json`にタグマスター追加
- [ ] `src/components/DeckMetadata.vue`でタグ選択UIを有効化
  - 現在は空オブジェクト（`tags.value = {}`）のため選択不可

---

### 1. UIデザイン改善（優先度：高）

#### 1.1 ダイアログのデザイン統一
- [ ] オプション画面（`src/options/App.vue`）のデザイン改善
  - モダンなカード型レイアウトに変更
  - CSS変数の完全適用（ダークモード対応）
  - フォント、余白、影の調整
- [ ] エクスポートダイアログ（`src/components/ExportDialog.vue`）のデザイン改善
  - グラデーション効果の追加
  - アニメーション効果の追加
  - アイコンとボタンのスタイル統一
- [ ] デッキ画像作成ダイアログ（`src/content/deck-recipe/imageDialog.ts`）のデザイン改善
  - カラーパレットの統一
  - モダンなフォームスタイル
  - レスポンシブ対応

#### 1.2 デザインシステムの確立
- [ ] 共通のダイアログコンポーネント作成（`src/components/BaseDialog.vue`）
  - ヘッダー、ボディ、フッターの統一レイアウト
  - アニメーション（フェードイン/スライドイン）
  - 閉じるボタンの統一スタイル
- [ ] カラーパレットの定義（`src/styles/colors.css`）
  - プライマリカラー、セカンダリカラー
  - ライト/ダークモードの色定義
  - グラデーション定義

---

### 2. デッキデータのエクスポート/インポート機能（優先度：高）

#### 2.1 エクスポート機能実装
- [x] CSV形式エクスポート関数（`src/utils/deck-export.ts`）
  - 常にname列を含む
  - フォーマット: `section,name,cid,ciid,quantity`
  - オプション: Include Side Deck（デフォルト: true）
- [x] TXT形式エクスポート関数
  - 人間が読みやすい形式
  - 例: `2x 灰流うらら (12950:1)`
- [x] エクスポートダイアログUI（`src/components/ExportDialog.vue`）
  - フォーマット選択（CSV/TXT）
  - Include Side Deckチェックボックス
  - ファイル名入力（デフォルト: `deck-{dno}.csv`）
- [x] DeckEditTopBarメニューにエクスポート項目追加
  - "Export Deck"

#### 2.2 テスト
- [ ] エクスポート関数のユニットテスト
  - 複数ciid対応
  - サイドデッキ含む/含まない
- [ ] インポートパーサーのユニットテスト
  - 柔軟な形式対応（name省略、ciid省略、複数行）
  - エラーハンドリング（不正な形式）
- [ ] E2Eテスト（エクスポート→インポート）

#### 2.3 サンプルファイル
- [x] `tmp/export-samples/deck-with-name.csv`
- [x] `tmp/export-samples/deck-with-name.txt`
- [x] `tmp/export-samples/README.md`

---

### 3. 画像サイズ切り替え実装（優先度：高）

> **Note**: 基盤実装完了（setProperty方式でCSS変数適用）→ `tasks/done.md` 参照

#### 3.1 UI実装
- [ ] オプション画面に設定項目追加
- [ ] デッキ編集画面にクイック切り替えボタン追加（オプション）

#### 3.2 テスト
- [ ] ユニットテスト
- [ ] E2Eテスト（サイズ切り替え）

---

### 4. カラーテーマ切り替え実装（優先度：高）

> **Note**: 基盤実装完了（themes.ts + applyTheme）→ `tasks/done.md` 参照

#### 4.1 コンポーネント修正
- [ ] 全コンポーネントのテーマ対応確認
- [ ] ハードコードされた色をCSS変数に置き換え

#### 4.2 UI実装
- [ ] オプション画面にテーマ選択追加
- [ ] デッキ編集画面にクイック切り替えボタン追加（オプション）

#### 4.3 テスト
- [ ] ユニットテスト
- [ ] E2Eテスト（テーマ切り替え）
- [ ] ダークテーマでの視覚確認

---

### 5. 言語切り替え実装（優先度：高）

> **Note**: 基盤実装完了（言語設定ストア + effectiveLanguage）→ `tasks/done.md` 参照

#### 5.1 API修正
- [ ] 全APIファイルに`request_locale`パラメータ付与ロジック追加
  - `src/api/deck-parser.ts`
  - `src/api/card-search.ts`
  - `src/api/card-faq.ts`
  - その他APIファイル
- [ ] 言語設定に応じたlocale付与

#### 5.2 UI実装
- [ ] オプション画面に言語選択UI追加
- [ ] 言語切り替え後のリロード処理

#### 5.3 テスト
- [ ] 各言語でのAPI動作確認
- [ ] E2Eテスト（言語切り替え）

---

### 6. オプション画面の拡張（優先度：中）

#### 6.1 新しいタブの追加
- [ ] "Settings"タブの作成
  - 画像サイズ設定
  - テーマ設定
  - 言語設定
  - その他設定項目
- [ ] 既存の"Omit and Usage"タブとの分離

#### 6.2 UI実装
- [ ] 設定項目のレイアウト
- [ ] 設定変更の即時反映
- [ ] 設定リセット機能

---

### 7. 統合テストとドキュメント（優先度：中）

#### 7.1 E2Eテスト
- [ ] 全機能の統合テストシナリオ作成
- [ ] テストスクリプト作成（`tmp/browser/e2e-v0.4.0-phase1.js`）

#### 7.2 ドキュメント更新
- [ ] README.md更新（v0.4.0新機能）
- [ ] CHANGELOG作成（`docs/changelog/v0.4.0-alpha.md`）
- [ ] 使い方ドキュメント更新

---

### Phase 1完了後のリリース作業

#### バージョン更新
- [ ] version.dat: 0.3.2 → 0.4.0-alpha
- [ ] manifest.json: 0.3.2 → 0.4.0
- [ ] package.json: 0.3.2 → 0.4.0

#### Git管理
- [ ] git commit（Phase 1完了）
- [ ] git push
- [ ] v0.4.0-alpha タグ作成
- [ ] ビルド・デプロイ

---

## Phase 3完了内容（参考）

### 1. 言語差異の調査（優先度: 最高）

#### 調査対象
- [x] 日本語と英語のページHTMLを取得
  - [x] カード詳細ページ（日本語・英語）
  - [x] デッキ表示ページ（英語）

- [x] テキスト記号の差異を調査
  - [x] 【】vs [] の違い → 確認済み（英語は[]を使用）
  - [x] ／ vs / の違い → 確認済み（両言語とも全角「／」）

- [x] 判定に使用されるテキストの調査
  - [x] 種族（ドラゴン族→Dragon、機械族→Machine）
  - [x] モンスタータイプ（通常→Normal、効果→Effect）

- [ ] 検索フォームから全マッピングを取得
  - [ ] 日本語検索フォームから全種族・タイプを取得
  - [ ] 英語検索フォームから全種族・タイプを取得
  - [ ] マッピングテーブルを作成

#### ドキュメント化
- [x] 調査結果をまとめる
  - [x] docs/research/i18n-investigation.md作成
  - [x] 記号の差異を確認
  - [x] パーサー修正が必要な箇所をリストアップ
- [ ] 検索フォームから取得したマッピングを追加

### 2. 他言語対応の実装方針決定（優先度: 高）

- [ ] 言語検出方法の決定
  - URL から言語を判定（?request_locale=en など）
  - ページのHTML要素から判定
  - ブラウザの言語設定から判定

- [ ] パーサーの修正方針
  - 画像ベースの判定を優先（すでに一部実装済み）
  - テキストベースの判定が必要な箇所を洗い出し
  - 多言語マッピングテーブルの設計

### 3. パーサーの多言語対応実装（優先度: 中）

- [ ] 言語検出機能の実装
- [ ] 多言語マッピングテーブルの実装
- [ ] パーサーの修正
  - card-search.ts
  - deck-detail-parser.ts
  - deck-list-parser.ts
  - card-faq.ts
- [ ] テストデータの追加（英語版）
- [ ] 自動テストの実行と修正

---

## 🔖 Phase 2 完了内容（参考）

### 1. デッキ画像作成機能（デッキ表示/編集ページ）

#### テスト作成（優先度: 最高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - デッキ編集ページのサンプルHTML
  - #bottom_btn_set要素を含む構造

- [ ] ボタン追加のテスト
  - #bottom_btn_setの右側にボタンが追加されるか
  - カメラアイコンが表示されるか
  - ボタンのスタイルが正しいか

- [ ] ダイアログ表示のテスト
  - ボタンクリックでダイアログが表示されるか
  - カラー選択UI（赤/青）が存在するか
  - QRコード有無チェックボックスが存在するか
  - スケール入力欄が存在するか
  - downloadボタンが存在するか

- [ ] 画像生成のテスト
  - downloadボタンクリックで画像生成が実行されるか
  - 選択したオプションが正しく渡されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/deck-recipe/addImageButton.ts
  - #bottom_btn_setの右側に追加
  - カメラアイコン

- [ ] ダイアログUI実装
  - src/content/deck-recipe/imageDialog.ts
  - カラー選択（赤/青）
  - QRコード有無
  - スケール指定
  - downloadボタン

- [ ] イベントハンドラ実装
  - downloadDeckRecipeImageの呼び出し
  - ダイアログの開閉処理

### 2. シャッフル機能（デッキ表示ページ）

#### テスト作成（優先度: 高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - #main > div.subcatergory > div > span:nth-child(3)を含む構造
  - メインデッキのカード画像要素

- [ ] ボタン追加のテスト
  - 指定位置に3つのボタンが追加されるか
  - シャッフル/ソート/flip and shuffleアイコンが表示されるか

- [ ] シャッフル機能のテスト
  - シャッフルボタンクリックでカード順序が変わるか
  - 元の順序が保存されるか

- [ ] ソート機能のテスト
  - ソートボタンクリックで元の順序に戻るか

- [ ] flip and shuffle機能のテスト
  - ボタンクリックでシャッフル + 裏面画像に置き換えられるか
  - 裏面画像クリックで表面画像が表示されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/shuffle/addShuffleButtons.ts
  - 3つのボタン追加

- [ ] シャッフル機能の実装
  - src/content/shuffle/shuffleDeck.ts
  - カード順序のシャッフル
  - 元順序の保存

- [ ] ソート機能の実装
  - src/content/shuffle/sortDeck.ts
  - 元順序への復元

- [ ] flip and shuffle機能の実装
  - src/content/shuffle/flipAndShuffle.ts
  - シャッフル + 裏面画像置き換え
  - クリックで表面表示

---

## 🔍 Phase 1完了タスク（参考）

### Phase 1完了: スタブ実装のパーサー詳細化

以下の3つのAPIは現在スタブ実装で、HTMLパーサーの実装が必要：

- [x] **カード詳細情報パーサー** (`src/api/card-search.ts`) - ✅ 完了
- [x] **カードQA一覧パーサー** (`src/api/card-faq.ts`) - ✅ 完了
- [x] **個別QA詳細パーサー** (`src/api/card-faq.ts`) - ✅ 完了

### Phase 1完了条件

- [x] テストページで全APIの動作確認
- [x] スタブ実装した3機能の詳細パーサー実装
  - [x] カード詳細情報（収録シリーズ・関連カード）
  - [x] カードQA一覧
  - [x] 個別QA詳細

---

## 🔍 Phase 3以降のタスク

### デッキレシピ画像機能の拡張
- [ ] ユニットテストの作成
- [ ] 複数フォーマットのサポート（JPEG、WebP）
- [ ] エラーハンドリングの強化

---

## 🚀 実装フェーズ（その他機能）

### Phase 2: セッション管理とデッキ操作の完全実装
- [ ] セッション管理の実装
  - `api/session.ts` - cgid/ytkn取得
- [ ] デッキ操作の完全実装
  - デッキ一覧取得
  - デッキ個別取得
  - デッキ新規作成
  - デッキ複製
  - デッキ削除
  - デッキ保存（カード情報の完全版を使用）

### Phase 3: UI実装（その他機能）
- [ ] Popup UIの実装
  - デッキ一覧表示
  - デッキ詳細表示
  - カード検索UI
  - デッキ編集UI
- [ ] Content Script UIの実装
  - ページ内へのUI注入
  - 既存UIの拡張

### Phase 4: テストとデプロイ
- [ ] ユニットテストの実装
  - パーサー関数のテスト
  - カードタイプ判定のテスト
  - マップ変換のテスト
- [ ] E2Eテストの実装
  - 既存の調査スクリプトをテストに変換
- [ ] デプロイ準備
  - manifest.jsonの最終調整
  - README.mdの作成

---

## 🔍 調査フェーズの残タスク（優先度: 低）

### カード詳細ページの完全調査
- [ ] カード詳細ページのURL形式の確認
  - cidからのURL生成方法
  - 複数バージョン（再録）がある場合の対応
- [ ] カード詳細情報の完全な構造確認
  - 効果テキストの取得
  - 裁定情報の取得
  - 関連カードの取得

### 他言語対応
- [ ] 他言語での動作確認
  - 英語（en）、韓国語（ko）、中国語（zh-CN）
  - 各言語でのi18nデータ作成
  - DOM属性ベース判定の言語非依存性確認

### エラーハンドリングと制限
- [ ] エラーハンドリングの詳細調査
  - バリデーションエラーのメッセージ形式
  - デッキ保存失敗時のエラー内容
- [ ] レート制限の有無確認
  - API呼び出し頻度制限
  - 一時的なアクセス制限

### 追加機能
- [ ] 公開デッキ機能の調査
  - 公開設定の変更方法
  - 公開デッキの検索方法
- [ ] カード画像hashの正確な生成ルール
  - 現在は `{cid}_1_1_1` で動作
  - 複数イラストがある場合の番号付け

---

## 📝 設計ドキュメント（完成済み）

以下のドキュメントを参照して実装を進めること：

- ✅ `docs/design/implementation-design.md` - 完全な実装設計
- ✅ `docs/design/implementation-guide.md` - 実装ガイド
- ✅ `docs/research/api-investigation-results.md` - API仕様詳細
- ✅ `docs/research/INVESTIGATION_SUMMARY.md` - 調査成果サマリー

---

**次のアクション**: デッキレシピ画像作成機能のUI統合（Phase 2）
