# TODO

未着手のタスク（優先度順）

## 📊 現状サマリー

**Phase 1（調査）**: ✅ 完了（全API実装・テスト完了）
**Phase 2（独立機能）**: 🚀 開始
**次のステップ**: デッキ画像作成機能とシャッフル機能の実装

---

## 🚀 Phase 2: 独立機能実装（TDD）

### 1. デッキ画像作成機能（デッキ表示/編集ページ）

#### テスト作成（優先度: 最高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - デッキ編集ページのサンプルHTML
  - #bottom_btn_set要素を含む構造

- [ ] ボタン追加のテスト
  - #bottom_btn_setの右側にボタンが追加されるか
  - カメラアイコンが表示されるか
  - ボタンのスタイルが正しいか

- [ ] ダイアログ表示のテスト
  - ボタンクリックでダイアログが表示されるか
  - カラー選択UI（赤/青）が存在するか
  - QRコード有無チェックボックスが存在するか
  - スケール入力欄が存在するか
  - downloadボタンが存在するか

- [ ] 画像生成のテスト
  - downloadボタンクリックで画像生成が実行されるか
  - 選択したオプションが正しく渡されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/deck-recipe/addImageButton.ts
  - #bottom_btn_setの右側に追加
  - カメラアイコン

- [ ] ダイアログUI実装
  - src/content/deck-recipe/imageDialog.ts
  - カラー選択（赤/青）
  - QRコード有無
  - スケール指定
  - downloadボタン

- [ ] イベントハンドラ実装
  - downloadDeckRecipeImageの呼び出し
  - ダイアログの開閉処理

### 2. シャッフル機能（デッキ表示ページ）

#### テスト作成（優先度: 高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - #main > div.subcatergory > div > span:nth-child(3)を含む構造
  - メインデッキのカード画像要素

- [ ] ボタン追加のテスト
  - 指定位置に3つのボタンが追加されるか
  - シャッフル/ソート/flip and shuffleアイコンが表示されるか

- [ ] シャッフル機能のテスト
  - シャッフルボタンクリックでカード順序が変わるか
  - 元の順序が保存されるか

- [ ] ソート機能のテスト
  - ソートボタンクリックで元の順序に戻るか

- [ ] flip and shuffle機能のテスト
  - ボタンクリックでシャッフル + 裏面画像に置き換えられるか
  - 裏面画像クリックで表面画像が表示されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/shuffle/addShuffleButtons.ts
  - 3つのボタン追加

- [ ] シャッフル機能の実装
  - src/content/shuffle/shuffleDeck.ts
  - カード順序のシャッフル
  - 元順序の保存

- [ ] ソート機能の実装
  - src/content/shuffle/sortDeck.ts
  - 元順序への復元

- [ ] flip and shuffle機能の実装
  - src/content/shuffle/flipAndShuffle.ts
  - シャッフル + 裏面画像置き換え
  - クリックで表面表示

---

## 🔍 Phase 1完了タスク（参考）

### Phase 1完了: スタブ実装のパーサー詳細化

以下の3つのAPIは現在スタブ実装で、HTMLパーサーの実装が必要：

- [x] **カード詳細情報パーサー** (`src/api/card-search.ts`) - ✅ 完了
- [x] **カードQA一覧パーサー** (`src/api/card-faq.ts`) - ✅ 完了
- [x] **個別QA詳細パーサー** (`src/api/card-faq.ts`) - ✅ 完了

### Phase 1完了条件

- [x] テストページで全APIの動作確認
- [x] スタブ実装した3機能の詳細パーサー実装
  - [x] カード詳細情報（収録シリーズ・関連カード）
  - [x] カードQA一覧
  - [x] 個別QA詳細

---

## 🔍 Phase 3以降のタスク

### デッキレシピ画像機能の拡張
- [ ] ユニットテストの作成
- [ ] 複数フォーマットのサポート（JPEG、WebP）
- [ ] エラーハンドリングの強化

---

## 🚀 実装フェーズ（その他機能）

### Phase 2: セッション管理とデッキ操作の完全実装
- [ ] セッション管理の実装
  - `api/session.ts` - cgid/ytkn取得
- [ ] デッキ操作の完全実装
  - デッキ一覧取得
  - デッキ個別取得
  - デッキ新規作成
  - デッキ複製
  - デッキ削除
  - デッキ保存（カード情報の完全版を使用）

### Phase 3: UI実装（その他機能）
- [ ] Popup UIの実装
  - デッキ一覧表示
  - デッキ詳細表示
  - カード検索UI
  - デッキ編集UI
- [ ] Content Script UIの実装
  - ページ内へのUI注入
  - 既存UIの拡張

### Phase 4: テストとデプロイ
- [ ] ユニットテストの実装
  - パーサー関数のテスト
  - カードタイプ判定のテスト
  - マップ変換のテスト
- [ ] E2Eテストの実装
  - 既存の調査スクリプトをテストに変換
- [ ] デプロイ準備
  - manifest.jsonの最終調整
  - README.mdの作成

---

## 🔍 調査フェーズの残タスク（優先度: 低）

### カード詳細ページの完全調査
- [ ] カード詳細ページのURL形式の確認
  - cidからのURL生成方法
  - 複数バージョン（再録）がある場合の対応
- [ ] カード詳細情報の完全な構造確認
  - 効果テキストの取得
  - 裁定情報の取得
  - 関連カードの取得

### 他言語対応
- [ ] 他言語での動作確認
  - 英語（en）、韓国語（ko）、中国語（zh-CN）
  - 各言語でのi18nデータ作成
  - DOM属性ベース判定の言語非依存性確認

### エラーハンドリングと制限
- [ ] エラーハンドリングの詳細調査
  - バリデーションエラーのメッセージ形式
  - デッキ保存失敗時のエラー内容
- [ ] レート制限の有無確認
  - API呼び出し頻度制限
  - 一時的なアクセス制限

### 追加機能
- [ ] 公開デッキ機能の調査
  - 公開設定の変更方法
  - 公開デッキの検索方法
- [ ] カード画像hashの正確な生成ルール
  - 現在は `{cid}_1_1_1` で動作
  - 複数イラストがある場合の番号付け

---

## 📝 設計ドキュメント（完成済み）

以下のドキュメントを参照して実装を進めること：

- ✅ `docs/design/implementation-design.md` - 完全な実装設計
- ✅ `docs/design/implementation-guide.md` - 実装ガイド
- ✅ `docs/research/api-investigation-results.md` - API仕様詳細
- ✅ `docs/research/INVESTIGATION_SUMMARY.md` - 調査成果サマリー

---

**次のアクション**: デッキレシピ画像作成機能のUI統合（Phase 2）
