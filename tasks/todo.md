# TODO

未着手のタスク（優先度順）

## 📊 現状サマリー

**Phase 1（調査）**: ✅ 完了（全API実装・テスト完了）
**Phase 2（独立機能）**: ✅ 完了（デッキ画像作成・シャッフル機能・オプションページ）
**Phase 3（デッキ編集UI + i18n基盤）**: ✅ 実装完了（PR#2マージ済み）
**次のステップ**: v0.3.0リリース準備（バージョン更新）

**最新の状況** (2025-11-13):
- ✅ テスト修正完了（vitest対応: __dirname polyfill追加）
- ✅ 単体テスト: 全Pass（tsx実行）
- ✅ 結合テスト: 全Pass（tsx実行）
- ✅ コンポーネントテスト: 51 passed | 3 skipped
- ✅ オプションページ修正完了
  - 拡張機能名を "Yugioh Neuron Helper" に統一
  - "独自デッキ編集画面" の表記に統一
  - 独自デッキ編集画面自体のON/OFF設定を追加（Omit and Usage タブ）
  - Deck Edit Settings タブで詳細設定を提供
  - 画面>機能の構造を維持
  - 画像を public/images/ に配置し、オプションページで表示可能に
- ✅ ドキュメント修正完了
  - docs/usage/index.md: オプションページの説明を実装に合わせて更新
  - README.md: すでに適切な画像を使用（修正不要）
- ✅ ビルド・デプロイ完了
- 📝 次: バージョン更新とリリース準備（スクリーンショット撮影後）

---

## 🚀 v0.3.0 リリースタスク（優先度：最高）

**目標日**: 2025-11-17  
**現在**: ドキュメント修正中 - スクリーンショット追加必要

### 🔴 ブロッカー: ドキュメント修正

#### ドキュメント構造修正 ✅
- [x] README.md: デッキ画像サンプルをダイアログではなく実際の出力画像に変更
- [x] README.md: 存在しないdeck-edit-demo.gifの参照を削除
- [x] docs/usage/index.md: 画面>機能の構造に修正
- [x] docs/usage/index.md: デッキ編集ページの詳細は deck-edit.md に移動
- [x] docs/usage/index.md: オプションページを実装状況に合わせて修正
- [x] オプションページの修正
  - [x] "Deck Edit Sample" タブ削除
  - [x] Omit and Usage タブを画面>機能の構造に再編（上下配置）
  - [x] デッキ表示ページの各機能に画像を追加
  - [x] デッキ編集ページのセクション追加
  - [x] Deck Edit Settings タブを追加
  - [x] 画像を public/images/ に配置

#### スクリーンショット追加必要（手動）📸
- [ ] `docs/usage/images/options-page.png` - オプションページ全体
- [ ] `docs/usage/images/deck-edit-demo.gif` - デッキ編集UIのデモ（オプション）
  
### 完了: カード枚数制限実装 ✅
- [x] main/extra/side合計で同じカード3枚まで制限
- [x] テスト追加（17tests → 17tests 全pass）
- [x] ドキュメント更新（docs/usage/deck-edit.md）
- [x] ビルド・デプロイ完了
- [x] テスト・ドキュメント最終確認完了

### 完了: テスト実装 ✅
**v0.3.0テスト**: 125tests（単体47 + 結合34 + コンポーネント54-3skip）
**実行方法**:
- `npm test` - 全テスト（tsx）
- `npm run test:components` - コンポーネントテスト（vitest）
- `npm run test:vitest` - 全vitestテスト

### 必須タスク（リリースブロッカー）

#### 2. ドキュメント整備 ✅
- [x] ユーザー向け: docs/usage/deck-edit.md作成
- [x] README.md更新（v0.3.0新機能説明）
- [x] 開発者向け: docs/dev/architecture.md, i18n.md作成

#### 3. オプションページ拡張 ✅
- [x] デッキ編集機能の設定UI（機能ON/OFF、デフォルト表示モード等）
- [x] 多言語設定UI（自動/手動選択）
- [x] 設定の保存・読み込み機能
- [x] DeckEditSettings型定義とユーティリティ関数

#### 4. リリース準備
- [ ] バージョン更新（version.dat, manifest.json, package.json → 0.3.0）
- [ ] CHANGELOG作成
- [ ] 最終動作確認（Chrome/Edge）

---

## 🌐 Phase 3完了内容（参考）

### 1. 言語差異の調査（優先度: 最高）

#### 調査対象
- [x] 日本語と英語のページHTMLを取得
  - [x] カード詳細ページ（日本語・英語）
  - [x] デッキ表示ページ（英語）

- [x] テキスト記号の差異を調査
  - [x] 【】vs [] の違い → 確認済み（英語は[]を使用）
  - [x] ／ vs / の違い → 確認済み（両言語とも全角「／」）

- [x] 判定に使用されるテキストの調査
  - [x] 種族（ドラゴン族→Dragon、機械族→Machine）
  - [x] モンスタータイプ（通常→Normal、効果→Effect）

- [ ] 検索フォームから全マッピングを取得
  - [ ] 日本語検索フォームから全種族・タイプを取得
  - [ ] 英語検索フォームから全種族・タイプを取得
  - [ ] マッピングテーブルを作成

#### ドキュメント化
- [x] 調査結果をまとめる
  - [x] docs/research/i18n-investigation.md作成
  - [x] 記号の差異を確認
  - [x] パーサー修正が必要な箇所をリストアップ
- [ ] 検索フォームから取得したマッピングを追加

### 2. 他言語対応の実装方針決定（優先度: 高）

- [ ] 言語検出方法の決定
  - URL から言語を判定（?request_locale=en など）
  - ページのHTML要素から判定
  - ブラウザの言語設定から判定

- [ ] パーサーの修正方針
  - 画像ベースの判定を優先（すでに一部実装済み）
  - テキストベースの判定が必要な箇所を洗い出し
  - 多言語マッピングテーブルの設計

### 3. パーサーの多言語対応実装（優先度: 中）

- [ ] 言語検出機能の実装
- [ ] 多言語マッピングテーブルの実装
- [ ] パーサーの修正
  - card-search.ts
  - deck-detail-parser.ts
  - deck-list-parser.ts
  - card-faq.ts
- [ ] テストデータの追加（英語版）
- [ ] 自動テストの実行と修正

---

## 🔖 Phase 2 完了内容（参考）

### 1. デッキ画像作成機能（デッキ表示/編集ページ）

#### テスト作成（優先度: 最高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - デッキ編集ページのサンプルHTML
  - #bottom_btn_set要素を含む構造

- [ ] ボタン追加のテスト
  - #bottom_btn_setの右側にボタンが追加されるか
  - カメラアイコンが表示されるか
  - ボタンのスタイルが正しいか

- [ ] ダイアログ表示のテスト
  - ボタンクリックでダイアログが表示されるか
  - カラー選択UI（赤/青）が存在するか
  - QRコード有無チェックボックスが存在するか
  - スケール入力欄が存在するか
  - downloadボタンが存在するか

- [ ] 画像生成のテスト
  - downloadボタンクリックで画像生成が実行されるか
  - 選択したオプションが正しく渡されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/deck-recipe/addImageButton.ts
  - #bottom_btn_setの右側に追加
  - カメラアイコン

- [ ] ダイアログUI実装
  - src/content/deck-recipe/imageDialog.ts
  - カラー選択（赤/青）
  - QRコード有無
  - スケール指定
  - downloadボタン

- [ ] イベントハンドラ実装
  - downloadDeckRecipeImageの呼び出し
  - ダイアログの開閉処理

### 2. シャッフル機能（デッキ表示ページ）

#### テスト作成（優先度: 高）
- [ ] テストHTML作成
  - デッキ表示ページのサンプルHTML
  - #main > div.subcatergory > div > span:nth-child(3)を含む構造
  - メインデッキのカード画像要素

- [ ] ボタン追加のテスト
  - 指定位置に3つのボタンが追加されるか
  - シャッフル/ソート/flip and shuffleアイコンが表示されるか

- [ ] シャッフル機能のテスト
  - シャッフルボタンクリックでカード順序が変わるか
  - 元の順序が保存されるか

- [ ] ソート機能のテスト
  - ソートボタンクリックで元の順序に戻るか

- [ ] flip and shuffle機能のテスト
  - ボタンクリックでシャッフル + 裏面画像に置き換えられるか
  - 裏面画像クリックで表面画像が表示されるか

#### 実装（TDD後）
- [ ] ボタン追加機能の実装
  - src/content/shuffle/addShuffleButtons.ts
  - 3つのボタン追加

- [ ] シャッフル機能の実装
  - src/content/shuffle/shuffleDeck.ts
  - カード順序のシャッフル
  - 元順序の保存

- [ ] ソート機能の実装
  - src/content/shuffle/sortDeck.ts
  - 元順序への復元

- [ ] flip and shuffle機能の実装
  - src/content/shuffle/flipAndShuffle.ts
  - シャッフル + 裏面画像置き換え
  - クリックで表面表示

---

## 🔍 Phase 1完了タスク（参考）

### Phase 1完了: スタブ実装のパーサー詳細化

以下の3つのAPIは現在スタブ実装で、HTMLパーサーの実装が必要：

- [x] **カード詳細情報パーサー** (`src/api/card-search.ts`) - ✅ 完了
- [x] **カードQA一覧パーサー** (`src/api/card-faq.ts`) - ✅ 完了
- [x] **個別QA詳細パーサー** (`src/api/card-faq.ts`) - ✅ 完了

### Phase 1完了条件

- [x] テストページで全APIの動作確認
- [x] スタブ実装した3機能の詳細パーサー実装
  - [x] カード詳細情報（収録シリーズ・関連カード）
  - [x] カードQA一覧
  - [x] 個別QA詳細

---

## 🔍 Phase 3以降のタスク

### デッキレシピ画像機能の拡張
- [ ] ユニットテストの作成
- [ ] 複数フォーマットのサポート（JPEG、WebP）
- [ ] エラーハンドリングの強化

---

## 🚀 実装フェーズ（その他機能）

### Phase 2: セッション管理とデッキ操作の完全実装
- [ ] セッション管理の実装
  - `api/session.ts` - cgid/ytkn取得
- [ ] デッキ操作の完全実装
  - デッキ一覧取得
  - デッキ個別取得
  - デッキ新規作成
  - デッキ複製
  - デッキ削除
  - デッキ保存（カード情報の完全版を使用）

### Phase 3: UI実装（その他機能）
- [ ] Popup UIの実装
  - デッキ一覧表示
  - デッキ詳細表示
  - カード検索UI
  - デッキ編集UI
- [ ] Content Script UIの実装
  - ページ内へのUI注入
  - 既存UIの拡張

### Phase 4: テストとデプロイ
- [ ] ユニットテストの実装
  - パーサー関数のテスト
  - カードタイプ判定のテスト
  - マップ変換のテスト
- [ ] E2Eテストの実装
  - 既存の調査スクリプトをテストに変換
- [ ] デプロイ準備
  - manifest.jsonの最終調整
  - README.mdの作成

---

## 🔍 調査フェーズの残タスク（優先度: 低）

### カード詳細ページの完全調査
- [ ] カード詳細ページのURL形式の確認
  - cidからのURL生成方法
  - 複数バージョン（再録）がある場合の対応
- [ ] カード詳細情報の完全な構造確認
  - 効果テキストの取得
  - 裁定情報の取得
  - 関連カードの取得

### 他言語対応
- [ ] 他言語での動作確認
  - 英語（en）、韓国語（ko）、中国語（zh-CN）
  - 各言語でのi18nデータ作成
  - DOM属性ベース判定の言語非依存性確認

### エラーハンドリングと制限
- [ ] エラーハンドリングの詳細調査
  - バリデーションエラーのメッセージ形式
  - デッキ保存失敗時のエラー内容
- [ ] レート制限の有無確認
  - API呼び出し頻度制限
  - 一時的なアクセス制限

### 追加機能
- [ ] 公開デッキ機能の調査
  - 公開設定の変更方法
  - 公開デッキの検索方法
- [ ] カード画像hashの正確な生成ルール
  - 現在は `{cid}_1_1_1` で動作
  - 複数イラストがある場合の番号付け

---

## 📝 設計ドキュメント（完成済み）

以下のドキュメントを参照して実装を進めること：

- ✅ `docs/design/implementation-design.md` - 完全な実装設計
- ✅ `docs/design/implementation-guide.md` - 実装ガイド
- ✅ `docs/research/api-investigation-results.md` - API仕様詳細
- ✅ `docs/research/INVESTIGATION_SUMMARY.md` - 調査成果サマリー

---

**次のアクション**: デッキレシピ画像作成機能のUI統合（Phase 2）
